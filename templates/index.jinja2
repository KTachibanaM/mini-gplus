{% from "_header.jinja2" import header %}
{% from "_form.jinja2" import field %}

<html>
<head>
    <title>mini-gplus</title>
</head>
<body>
<nav>
    {{ header('/') }} | Hi {{ current_user.user_id }} <a href="/signout">Signout</a>
</nav>
<form method="post">
    {{ field(form.content) }}
    {{ field(form.is_public) }}
    {{ field(form.circles) }}
    <input type='submit' value='Create new post'>
</form>
<ul>
    {% for post in posts %}
        <li>
            {% if post.author.id == current_user.id %}
                <form method="post" action="/rmpost" style="display: inline">
                    {{ post.author.user_id }} -> {{ post.sharing_scope_str }} @{{ post.created_at }}: {{ post.content }}
                    <input type="hidden" name="id" value="{{ post.id }}" readonly>
                    <input type="submit" value="Delete post">
                </form>
            {% else %}
                {{ post.author.user_id }} @{{ post.created_at }}: {{ post.content }}
            {% endif %}
            <ul>
                {% for comment in post.comments %}
                    <li>
                        {{ comment.author.user_id }} @{{ comment.created_at }}: {{ comment.content }}
                    </li>
                {% endfor %}
                <li>
                    <form method="post" action="/addcomment">
                        <input type="hidden" name="post_id" value="{{ post.id }}" readonly>
                        <input name="content">
                        <input type="submit" value="Comment">
                    </form>
                </li>
            </ul>
        </li>
    {% endfor %}
</ul>
</body>
</html>